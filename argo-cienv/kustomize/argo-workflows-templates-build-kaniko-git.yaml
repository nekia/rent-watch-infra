apiVersion: argoproj.io/v1alpha1
kind: ClusterWorkflowTemplate
metadata:
  name: container-image
spec:
  serviceAccountName: workflow
  templates:
  - name: build-kaniko-git
    inputs:
      parameters:
      - name: app_repo
      - name: container_image
      - name: short-sha
      - name: subpath
    container:
      image: gcr.io/kaniko-project/executor:debug
      command: [/kaniko/executor]
      args:
      - --context={{inputs.parameters.app_repo}}
      - --destination=local.insecure-registry.io/{{inputs.parameters.container_image}}:{{inputs.parameters.short-sha}}
      - --context-sub-path={{inputs.parameters.subpath}}
      - --insecure-registry=local.insecure-registry.io
      volumeMounts:
        - name: kanikoregcred
          mountPath: /kaniko/.docker/
